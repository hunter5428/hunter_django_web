{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'str_dashboard/css/menu1_1.css' %}">
<link rel="stylesheet" href="{% static 'str_dashboard/css/table.component.css' %}">
<link rel="stylesheet" href="{% static 'str_dashboard/css/customer_unified.css' %}">
{% endblock %}

{% block content %}
<!-- 상단 컨트롤 영역 -->
<div class="top-row">
    <button class="btn" id="btn-open-db-modal">DB Connection</button>
    {% if db_status == 'ok' %}
        <span id="db-status" class="badge ok">연결 완료</span>
    {% else %}
        <span id="db-status" class="badge">연결 필요</span>
    {% endif %}
</div>

<!-- 조회 영역 -->
<div class="query-row">
    <span class="label-chip">ALERT ID</span>
    <input id="alert_id_input" type="text" class="form-input" placeholder="ALERT ID를 입력하세요">
    <button class="btn" id="alert_id_search_btn">조회</button>
</div>

<!-- 2분할 레이아웃: 고객 정보 & 동일_차명의심_상세 정보 -->
<div class="split-layout-container">
    <!-- 왼쪽: 통합 고객 정보 -->
    <div class="split-left">
        <div id="section_customer_unified" class="section" style="display:none;">
            <h3>고객 정보</h3>
            <div class="table-wrap" id="result_table_customer_unified"></div>
        </div>
    </div>
    
    <!-- 오른쪽: 동일_차명의심_상세 정보 -->
    <div class="split-right">
        <div id="section_duplicate_persons" class="section" style="display:none;">
            <h3>동일_차명의심_상세 정보</h3>
            <div class="table-wrap" id="result_table_duplicate_persons"></div>
        </div>
    </div>
</div>

<!-- 섹션: 법인 관련인 정보 -->
<div id="section_corp_related" class="section" style="display:none;">
    <h3>법인 관련인 정보</h3>
    <div class="table-wrap" id="result_table_corp_related"></div>
</div>

<!-- 섹션: 개인 관련인 정보 (내부입출금 거래) -->
<div id="section_person_related" class="section" style="display:none;">
    <h3>개인 관련인 정보 (내부입출금 거래)</h3>
    <div class="table-wrap" id="result_table_person_related"></div>
</div>

<!-- 섹션: RULE_ID_히스토리 -->
<div id="section_rule_hist" class="section" style="display:none;">
    <h3>RULE_ID_히스토리 탐색</h3>
    <div class="table-wrap" id="result_table_rule_hist"></div>
</div>

<!-- 섹션: 의심거래 객관식 정보 -->
<div id="section_objectives" class="section" style="display:none;">
    <h3>의심거래 객관식 정보</h3>
    <div class="table-wrap" id="result_table_objectives"></div>
</div>

<!-- 섹션: ALERT / RULE 발생 내역 -->
<div id="section_alert_rule" class="section" style="display:none;">
    <h3>ALERT / RULE 발생 내역</h3>
    <div class="table-wrap" id="result_table_alert_rule"></div>
</div>

<!-- 섹션: 발생한 RULE의 정보(DISTINCT) -->
<div id="section_rule_distinct" class="section" style="display:none;">
    <h3>발생한 RULE의 정보(DISTINCT)</h3>
    <div class="table-wrap" id="result_table_rule_distinct"></div>
</div>

<!-- DB 연결 모달 -->
<div class="modal-backdrop" id="db-modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="db-modal-title">
        <h3 id="db-modal-title">오라클 연결 설정</h3>
        <div class="grid">
            <label for="host">host</label> 
            <input id="host" type="text" value="{{ default_host }}">
            
            <label for="port">port</label> 
            <input id="port" type="text" value="{{ default_port }}">
            
            <label for="service_name">service name</label> 
            <input id="service_name" type="text" value="{{ default_service }}">
            
            <label for="username">user name</label> 
            <input id="username" type="text" value="{{ default_username }}">
            
            <label for="password">pass word</label> 
            <input id="password" type="password" value="">
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" id="btn-close-db-modal">뒤로</button>
            <button class="btn btn-primary" id="btn-test-conn">연결 확인</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 전역 설정
window.RULE_OBJ_MAP = {{ rule_obj_map_json|safe }};

window.URLS = {
    test_connection: "{% url 'test_oracle_connection' %}",
    query_alert: "{% url 'query_alert_info' %}",
    query_customer_unified: "{% url 'query_customer_unified' %}",
    rule_history: "{% url 'rule_history_search' %}",
    query_duplicate_unified: "{% url 'query_duplicate_unified' %}",
    query_corp_related_persons: "{% url 'query_corp_related_persons' %}",
    query_person_related_summary: "{% url 'query_person_related_summary' %}",
    query_ip_access_history: "{% url 'query_ip_access_history' %}" 
};
</script>

<!-- 테이블 컴포넌트 -->
<script src="{% static 'str_dashboard/js/table.component.js' %}"></script>

<!-- 페이지 메인 로직 -->
<script src="{% static 'str_dashboard/js/menu1_1.js' %}"></script>
{% endblock %}