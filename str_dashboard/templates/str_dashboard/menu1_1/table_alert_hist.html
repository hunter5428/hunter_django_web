<!-- ALERT / RULE 발생 내역 -->
<style>
  #section_alert_rule.section{ margin-top:18px; }
  #section_alert_rule .table-wrap{ margin-top:6px; }
  #section_alert_rule .table{
    width:100%; border-collapse:collapse; border:1px solid #2a2a2a;
    border-radius:12px; overflow:hidden; background:#1a1a1a;
  }
  #section_alert_rule .table th, #section_alert_rule .table td{
    border-bottom:1px solid #2a2a2a; padding:10px 12px; text-align:left; color:#eaeaea;
  }
  #section_alert_rule .table th{ background:#111; color:#bdbdbd; font-weight:700; }
  #section_alert_rule .table tr:hover td{ background:#181818; }
  #section_alert_rule .empty-row{ color:#bdbdbd; padding:16px 12px; }

  /* 대표 ALERT 강조 */
  #section_alert_rule .table tr.rep-row td { background:#383838 !important; }
</style>

<div id="section_alert_rule" class="section" style="display:none;">
  <h3>ALERT / RULE 발생 내역</h3>
  <div class="table-wrap" id="result_table_alert_rule"></div>
</div>

<script>
  // alertId: 조회에 입력한 대표 ALERT ID
  window.renderAlertHistSection = function(cols, rows, alertId){
    const section = document.getElementById('section_alert_rule');
    const wrap    = document.getElementById('result_table_alert_rule');

    const idx = {
      STDS_DTM: cols.indexOf('STDS_DTM'),
      CUST_ID: cols.indexOf('CUST_ID'),
      STR_RULE_ID: cols.indexOf('STR_RULE_ID'),
      STR_ALERT_ID: cols.indexOf('STR_ALERT_ID'),
      STR_RPT_MNGT_NO: cols.indexOf('STR_RPT_MNGT_NO'),
      STR_RULE_NM: cols.indexOf('STR_RULE_NM'),
    };

    section.style.display = 'block';
    if (!rows.length || Object.values(idx).some(v => v < 0)){
      wrap.innerHTML = '<div class="card empty-row">결과가 없습니다.</div>';
      return;
    }

    const header = ['STDS_DTM','CUST_ID','STR_RULE_ID','STR_ALERT_ID','STR_RPT_MNGT_NO','STR_RULE_NM'];
    const thead  = '<tr>' + header.map(h => `<th>${h}</th>`).join('') + '</tr>';

    const tbody  = rows.map(r => {
      const vals = header.map(h => (r[idx[h]] == null) ? '' : r[idx[h]]);
      const isRep = (idx.STR_ALERT_ID >= 0) && (String(r[idx.STR_ALERT_ID]) === String(alertId));
      const cls = isRep ? ' class="rep-row"' : '';
      return `<tr${cls}>` + vals.map(v => `<td>${v}</td>`).join('') + `</tr>`;
    }).join('');

    wrap.innerHTML = `<table class="table"><thead>${thead}</thead><tbody>${tbody}</tbody></table>`;
  };
</script>
